# Лекція 6. Spring Data JDBC

## Оновіть структуру бази даних

Запустіть скрипт з папки `src/main/resources/db/migration/V1_db_init.sql`, щоб ініціалізувати базу даних.

**Увага!** дані, що знаходяться в базі, буде видалено. Якщо вам потрібні ці дані, збережіть їх окремо.

## Створіть класс Post, який відображатиме структуру поста в базі даних
1. Створіть клас `PostEntity` в `repository/model`
2. Анотуйте поле id за допомогою `@Id`
3. Використайте `User` як приклад.

## Створіть конвертер для перетворення Post з DTO в Entity
1. Імплементуйте інтерфейс `Converter`
2. Додайте новий конвертер в `PostService`, використовуйте його для перетворення обʼєкта 

## Створіть Spring Data репозиторій для роботи з постами

*** Ознайомтесь з кодом `UserRepository` та `UserRepositoryTest` ***. Використовуйте його як зразок.

1. Репозиторій мусить бути інтерфейсом, що розширює `Repository` або `CrudRepository`
   * Якщо ви використовуєте `CrudRepository`, багато методів (напр. `findById`) самостійно декларувати не треба, вони
     вже оголошені в `CrudRepository`
2. Видаліть існуючий in-memory репозиторій для постів, або зробіть так, щоб він не наслідував `PostRepository` 
3. Створіть тести для свого репозиторія на наступні методи:
   * `findByid`
   * `save`
   * `count`
   * `findAll`
4. Клас теста мусить бути помічений анотацією `@Transactional`, щоб ваші тестові дані автоматично видалялись з бази після завершення теста.
   Використовуйте `UserRepositoryTest` як приклад. 

## Створіть метод, що поверне `last_name` користувача з найбільшою кількістю постів

Це можна зробити декількома шляхами:
1. Простий, але не ефективний (2 виклики до 2 репозиторіїв):
   * в `PostRepository` додайте метод, який поверне id користувача з найбільшою кількістю постів
     * в разі необхідності використайте анотацію `@Query` для того, щоб створити відповідну `SQL query`
   * на рівні сервіса:
     * викличте спочатку цей метод, отримайте `user_id`, 
     * потім викличте `userRepository`, знайдіть користувача по `id`

2. Складний, але ефективний (1 виклик до 1 репозиторія):
   * Додайте метод в `UserRepository`, який поверне користувача, що має найбільшу кількість постів
   * використайте анотацію `@Query` для того, щоб створити відповідну `SQL query`
     * використайте оператор `join`
